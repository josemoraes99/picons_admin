"use strict";let channelList;const formLoginButton=document.querySelector(".form-signin");formLoginButton.addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("inputUsername").value.trim(),n=document.getElementById("inputPassword").value.trim();processLogin(t,n),formLoginButton.reset(),document.getElementById("inputUsername").focus()});const menuNewPiconShow=document.querySelector(".newPiconsMenu");menuNewPiconShow.addEventListener("click",e=>{document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tabsPanel").forEach(e=>{e.classList.add("d-none")}),document.querySelector(".newPiconsMenu").parentElement.classList.add("active"),document.querySelector(".painelNewPicons").classList.remove("d-none")});const menuListaCompleta=document.querySelector(".listaCompletaMenu");menuListaCompleta.addEventListener("click",e=>{document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tabsPanel").forEach(e=>{e.classList.add("d-none")}),document.querySelector(".listaCompletaMenu").parentElement.classList.add("active"),document.querySelector(".painelListaCompleta").classList.remove("d-none")});const menuUtil=document.querySelector(".utilMenu");menuUtil.addEventListener("click",e=>{document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".tabsPanel").forEach(e=>{e.classList.add("d-none")}),document.querySelector(".utilMenu").parentElement.classList.add("active"),document.querySelector(".util").classList.remove("d-none")});const menuListaRefresh=document.querySelector(".refreshMenu");menuListaRefresh.addEventListener("click",e=>{refreshChannels()});const addCanalRequerido=document.querySelector(".addCanalRequerido");addCanalRequerido.addEventListener("submit",e=>{e.preventDefault();const t=addCanalRequerido.add.value.trim();addCanalRequerido.reset(),renderAddCanalRequerido(t),enviarCanalRequerido(t)});const addCanalIptv=document.querySelector(".addCanalIptv");addCanalIptv.addEventListener("submit",e=>{e.preventDefault();const t=addCanalIptv.add.value.trim();addCanalIptv.reset(),renderAddCanalIPTV(t),enviarCanalIptv(t)}),document.querySelector(".listCanaisRequeridos").addEventListener("click",e=>{e.target.classList.contains("delete")&&(e.target.parentElement.remove(),removerCanalRequerido(e.target.parentElement.querySelector("span").innerText))}),document.querySelector(".listCanaisIPTV").addEventListener("click",e=>{e.target.classList.contains("delete")&&(e.target.parentElement.remove(),removerCanalIptv(e.target.parentElement.querySelector("span").innerText))}),document.querySelector(".btnRemoveAll").addEventListener("click",e=>{removeAllUndef()});const menuLogout=document.querySelector(".menuLogout");menuLogout.addEventListener("click",e=>{const t={method:"logout",token:key_mgmt.getKey()};getUrlData(t),key_mgmt.setKey(!1);saveToIndexedDB("objectstoreName",{id:"tk",data:""}),showPage()});const dynamicSort=e=>{let t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,a){return(n[e]<a[e]?-1:n[e]>a[e]?1:0)*t}},myAlertBar=(e,t=!1)=>{const n=document.querySelector(".alertRefresh"),a=document.querySelector(".refreshSpinner");!0===t?a.classList.remove("d-none"):a.classList.add("d-none"),document.querySelector(".alertRefreshMsg").innerHTML=e,n.classList.toggle("d-none"),setTimeout(function(){n.classList.toggle("d-none")},2e3)};function saveToIndexedDB(e,t){return new Promise(function(n,a){void 0===t.id&&a(Error("object has no id."));var o=indexedDB.open(e);o.onerror=function(e){a(Error("IndexedDB database error"))},o.onupgradeneeded=function(t){t.target.result.createObjectStore(e,{keyPath:"id"})},o.onsuccess=function(o){var r=o.target.result.transaction([e],"readwrite").objectStore(e).put(t);r.onerror=function(e){a(Error("Error text"))},r.onsuccess=function(e){n("Data saved OK")}}})}function loadFromIndexedDB(e,t){return new Promise(function(n,a){var o=indexedDB.open(e);o.onerror=function(e){a(Error("Error text"))},o.onupgradeneeded=function(e){e.target.transaction.abort(),a(Error("Not found"))},o.onsuccess=function(o){var r=o.target.result.transaction([e]).objectStore(e).get(t);r.onerror=function(e){a(Error("Error text"))},r.onsuccess=function(e){r.result?n(r.result):a(Error("object not found"))}}})}const showPage=async()=>{key_mgmt.getKey()?(myAlertBar("Atualizando",!0),loadChannelsList(),document.querySelector(".painelLogin").classList.add("d-none"),document.querySelector(".painelPrincipal").classList.remove("d-none")):(document.querySelector(".painelPrincipal").classList.add("d-none"),document.querySelector(".painelLogin").classList.remove("d-none"))},processLogin=async(e,t)=>{const n={username:e,password:t},a=await fetch("https://1wdtecach7.execute-api.sa-east-1.amazonaws.com/prod/auth",{method:"post",body:JSON.stringify(n)});let o=await a.json();o.auth?(key_mgmt.setKey(o.token),saveTokenInLocalDb(o.token),showPage()):(document.querySelector(".loginerrormsg").classList.remove("d-none"),setTimeout(function(){document.querySelector(".loginerrormsg").classList.add("d-none")},5e3))},saveTokenInLocalDb=e=>{saveToIndexedDB("objectstoreName",{id:"tk",data:e}).then(function(e){console.log("token saved")}).catch(function(e){console.log(e.message)})},loadChannelsList=async()=>{const e=await getListChannels();channelList=e.list;const t=e.filtroCanais;channelList&&(channelList.sort(dynamicSort("channell")),processChannelList(channelList),processFilterList(t))},getUrlData=async e=>{let t=key_mgmt.getKey();if(t)try{const n=await fetch("https://1wdtecach7.execute-api.sa-east-1.amazonaws.com/prod",{method:"post",body:JSON.stringify(e)});let a=await n.json();return a.auth?(t!=a.token&&(key_mgmt.setKey(a.token),saveTokenInLocalDb(a.token)),a.data):(key_mgmt.setKey(!1),showPage(),!1)}catch(e){console.log(e)}},getListChannels=async()=>{console.log("load list");const e={method:"list",token:key_mgmt.getKey()};let t=await getUrlData(e);return t||!1},processChannelList=e=>{let t=e.filter(e=>"undef"==e.stat),n=e.filter(e=>"undef"!=e.stat),a=n.filter(e=>"file"==e.stat),o=document.querySelector(".ulPainelNewPicons"),r=document.querySelector(".ulpainelListaCompleta");o.textContent="",r.textContent="",a.unshift({channell:""});const l=createElement({tagName:"select",className:"selectChannelWithFile",childs:a.map(function(e){return createElement({tagName:"option",text:e.channell})})}),s=createElement({tagName:"select",className:"selectCategorie",childs:["variedades","interno","adultos"].map(function(e){return createElement({tagName:"option",text:e})})});t.forEach(function(e,t){let n=l.cloneNode(!0);n.id="sele."+e.channell;const a=createElement({tagName:"li",className:"list-group-item d-flex justify-content-between align-items-center",childs:[createElement({tagName:"span",className:"col-sm-3",text:e.channell}),createElement({tagName:"span",className:"col-sm-3",childs:[n]}),createElement({tagName:"span",className:"col-sm-1",html:'<i class="far fa-trash-alt delete btnRemove" id="button.'+e.channell+'"></i>'})]});o.appendChild(a)}),n.forEach(function(e,t){let n=s.cloneNode(!0);n.id="seleCat."+e.channell,n.value=e.categoria,"file"!=e.stat&&(n.disabled=!0);const a=createElement({tagName:"li",className:"list-group-item d-flex justify-content-between align-items-center",childs:[createElement({tagName:"span",className:"col-sm-3",text:e.channell}),createElement({tagName:"span",className:"col-sm-3",text:e.redir}),createElement({tagName:"span",className:"col-sm-3",childs:[n]}),createElement({tagName:"span",className:"col-sm-1",html:"file"!=e.stat?'<i class="fas fa-trash-restore delete btnRemoveRedir" id="button.'+e.channell+'"></i>':""})]});r.appendChild(a)}),afterDomChange()},processFilterList=e=>{document.querySelector(".listCanaisRequeridos").textContent="",document.querySelector(".listCanaisIPTV").textContent="",e.canais_requeridos.map(e=>renderAddCanalRequerido(e)),e.canais_iptv.map(e=>renderAddCanalIPTV(e))},renderAddCanalRequerido=e=>{const t=`\n        <li class="list-group-item d-flex justify-content-between align-items-center">\n            <span>${e}</span>\n            <i class="far fa-trash-alt delete"></i>\n        </li>\n    `;document.querySelector(".listCanaisRequeridos").innerHTML+=t},renderAddCanalIPTV=e=>{const t=`\n        <li class="list-group-item d-flex justify-content-between align-items-center">\n            <span>${e}</span>\n            <i class="far fa-trash-alt delete"></i>\n        </li>\n    `;document.querySelector(".listCanaisIPTV").innerHTML+=t},afterDomChange=()=>{document.querySelectorAll(".selectChannelWithFile").forEach(e=>{e.addEventListener("change",e=>{const t=e.target.id.replace("sele.",""),n=e.target.value;changeChannelStat(t,n)})}),Array.from(document.querySelectorAll(".selectCategorie")).map(e=>{e.addEventListener("change",e=>{const t=e.target.id.replace("seleCat.",""),n=e.target.value;changeChannelCategorie(t,n)})}),document.querySelectorAll(".btnRemove").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.id.replace("button.","");removeChannel(t)})}),document.querySelectorAll(".btnRemoveRedir").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.id.replace("button.","");changeChannelStat(t,"1")})})},refreshChannels=async()=>{console.log("refresh list");const e={method:"refresh",token:key_mgmt.getKey()};await getUrlData(e)&&(myAlertBar("Atualizando",!0),await loadChannelsList())},changeChannelCategorie=async(e,t)=>{console.log("change channel",e,t);const n={method:"changeCategorie",channel:e,newCategorie:t,token:key_mgmt.getKey()};await getUrlData(n)&&(myAlertBar("Alterado"),await loadChannelsList())},changeChannelStat=async(e,t)=>{console.log("change channel",e,t);const n={method:"changeChannel",channel:e,redir:t,token:key_mgmt.getKey()};await getUrlData(n)&&(myAlertBar("Alterado!"),channelList.forEach(function(n,a){n.channell==e&&(1!=t?(n.stat="redir",n.redir=t):(n.stat="undef",n.redir=!1))}),processChannelList(channelList))},removeChannel=async e=>{console.log("change channel",e);const t={method:"remove",channel:e,token:key_mgmt.getKey()};if(await getUrlData(t)){myAlertBar("Removido!");for(let t=0;t<channelList.length;t++){channelList[t].channell==e&&channelList.splice(t,1)}processChannelList(channelList)}},enviarCanalRequerido=async e=>{const t={method:"add_canal_requerido",channel:e,token:key_mgmt.getKey()};await getUrlData(t)&&myAlertBar("adicionado!")},enviarCanalIptv=async e=>{const t={method:"add_canal_iptv",channel:e,token:key_mgmt.getKey()};await getUrlData(t)&&myAlertBar("adicionado!")},removerCanalRequerido=async e=>{const t={method:"remove_canal_requerido",channel:e,token:key_mgmt.getKey()};await getUrlData(t)&&myAlertBar("removido!")},removerCanalIptv=async e=>{const t={method:"remove_canal_iptv",channel:e,token:key_mgmt.getKey()};await getUrlData(t)&&myAlertBar("removido!")},removeAllUndef=async()=>{const e={method:"remove_all_undef",token:key_mgmt.getKey()};await getUrlData(e)&&await loadChannelsList()},checkJWT=async e=>{try{e((await loadFromIndexedDB("objectstoreName","tk")).data)}catch(e){console.log(e.message)}},key_mgmt=(()=>{let e=!1;return{getKey:()=>e,setKey:t=>{e=t}}})(),main=async()=>{await checkJWT(key_mgmt.setKey),showPage()};function createElement(e){var t,n,a;if(e.tagName){if(t=document.createElement(e.tagName),e.className&&(t.className=e.className),e.attributes)for(n in e.attributes)t.setAttribute(n,e.attributes[n]);void 0!==e.html&&(t.innerHTML=e.html)}else t=document.createDocumentFragment();if(e.text&&t.appendChild(document.createTextNode(e.text)),void 0===window.HTMLElement&&(window.HTMLElement=Element),e.childs&&e.childs.length)for(a=0;a<e.childs.length;a++)t.appendChild(e.childs[a]instanceof window.HTMLElement?e.childs[a]:createElement(e.childs[a]));return t}main();